## 作用域

作用域是指程序源代码中定义变量的区域。  
作用域分为全局作用域和函数作用域

看一段代码来了解下全局作用域和函数作用域

```js
// 全局作用域
var a = 1;

function foo() {
  // 函数作用域
  console.log(a);
}

function bar() {
  // 函数作用域
  var a = 2;
  foo();
}

bar();
```

## 词法作用域（静态作用域）和动态作用域

词法作用域：作用域在定义时就已经确定
动态作用域：作用域在调用时才确定的

看上边代码，会输出什么呢？

词法作用域结果：从 foo 内部查找局部变量 a,没有就根据书写位置继续向上查找 也就是 a=1,所以输出 1
动态作用域结果：从 foo 内部查找局部变量 a,没有继续向上查找，就是从调用的函数作用查找，找到 a=2,所以打印 2

而 js 是采用的词法作用域，所以 在 js 环境下会输出 1

## 作用域的浅层次理解

1.全局作用域

- 全局作用域在页面打开时创建，页面关闭时销毁
- 编写在 script 中的变量和函数，作用域为全局，在任何地方都可以访问到
- 在全局作用域中有全局对象 window,代表一个浏览器窗口，由浏览器创建，可以直接调用
- 全局作用域中声明的变量和函数会作为 window 对象的属性和方法保存

  2.函数作用域

- 调用函数时，函数作用域被创建，函数执行完毕，函数作用域被销毁
- 每调用一次函数就会创建一个新的函数作用域，他们之间相互独立
- 在函数作用域中可以访问到全局作用域的变量，在函数外无法访问到函数作用域内的变量
- 在函数作用域访问变量，函数会在自身作用域查找，没有找到则会到函数的上一级作用域查找，直到全局作用域，找不到则返回 null

## 作用域的深层次理解

- 执行期的上下文
  - 当函数代码执行的前期，会创建一个执行期上下文的内部对象 AO （作用域）
  - 这个内部对象是预编译的时候创建出来的，因为当函数被调用的时候，会先进行预编译
  - 在全局代码执行的前期会创建一个执行期的上下文对象 GO
- 预编译
  - 预编译参考第一篇文章，有详细解释

## 作用域链

看一段代码

```js
var a = 1;
function fn() {
  var b = 2;
  function bar() {
    console.log(a + b);
  }
  return bar();
}
fn();
```

当我们执行 bar 函数时，我们会在 bar 内部查找 a 和 b 变量，如果没有，那么我们会继续向上查找，到 fn 的作用域查找，这个时候找到 b,这个时候我们还差一个变量 a 继续向上查找，一直会到最后的全局作用域，如果全局作用域没有，那么返回 null,这个过程形成的链就是作用域链

参考文章：https://github.com/mqyqingfeng/Blog/issues/3
